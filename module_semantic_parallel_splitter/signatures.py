"""
Сигнатуры для модуля семантической сегментации текста
"""
import dspy


class SemanticSplitSignature(dspy.Signature):
    """
    Разбей текст на семантически связанные сегменты/блоки.

    Задача:
    - Проанализируй текст и выдели в нём логические смысловые блоки
    - Каждый сегмент должен представлять собой завершённую мысль
    - Сегменты должны быть примерно одинакового размера (по возможности)
    - Сохраняй исходную структуру текста внутри сегментов

    Формат ответа:
    - Верни список сегментов в формате JSON или разделённых маркерами
    - Каждый сегмент должен содержать исходный текст
    - Можно добавить краткое описание для каждого сегмента
    """

    # Входные поля
    input_text = dspy.InputField(desc="Исходный текст для сегментации")
    max_segments = dspy.InputField(
        desc="Максимальное количество сегментов (опционально)",
        default=None
    )
    min_segment_length = dspy.InputField(
        desc="Минимальная длина сегмента в символах (опционально)",
        default=None
    )

    # Выходные поля
    segments = dspy.OutputField(
        desc="Список семантических сегментов текста"
    )
    segment_descriptions = dspy.OutputField(
        desc="Краткие описания для каждого сегмента (опционально)",
        default=None
    )


class SemanticHalverSignature(dspy.Signature):
    """
    Проанализируй фрагмент текста и определи границы первого смыслового куска.

    Твоя задача - найти в тексте первый логически завершенный смысловой блок с самого начала.
    Этот кусок должен быть самодостаточным по смыслу и логически завершенным. Например, байка, или кейс.
    Не обрывай предложения и не обрывай логические цепочки.

    Важно:
    - Возвращай ТОЧНУЮ подстроку из исходного текста
    - НЕ измений исходный текст первого куска, оставь текст полностью как есть
    - Не переводи, не форматируй, не изменяй текст
    - Просто выдели смысловой кусок как есть
    """

    text = dspy.InputField(desc="Полный текст для анализа и разделения на куски.")
    first_block = dspy.OutputField(
        desc="Первый смысловой кусок из текста - точная подстрока без изменений."
    )