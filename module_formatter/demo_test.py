"""
–î–µ–º–æ-—Ç–µ—Å—Ç –º–æ–¥—É–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
"""
import os
import sys

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from module_formatter.config import configure_module_llm
from module_formatter.module import TextFormatter


# –¢–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã –Ω–µ–æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
TEST_EXAMPLES = [
    {
        "name": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç",
        "text": """Python —ç—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤ 1991 –≥–æ–¥—É –ì–≤–∏–¥–æ –≤–∞–Ω –†–æ—Å—Å—É–º–æ–º.–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏,–∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö,–º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Python –ø—Ä–æ—Å—Ç–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å.–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ Django –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏,NumPy –∏ Pandas –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏,TensorFlow –∏ PyTorch –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è."""
    },
    {
        "name": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
        "text": """–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ—Ñ–µ –Ω–∞–ª–µ–π—Ç–µ —Å–≤–µ–∂—É—é —Ö–æ–ª–æ–¥–Ω—É—é –≤–æ–¥—É –≤ —á–∞–π–Ω–∏–∫ –¥–æ–≤–µ–¥–∏—Ç–µ –¥–æ –∫–∏–ø–µ–Ω–∏—è –Ω–æ –Ω–µ –∫–∏–ø—è—Ç–∏—Ç–µ –≤–æ–∑—å–º–∏—Ç–µ 2 —Å—Ç–æ–ª–æ–≤—ã–µ –ª–æ–∂–∫–∏ –º–æ–ª–æ—Ç–æ–≥–æ –∫–æ—Ñ–µ –Ω–∞ 200 –º–ª –≤–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—É—é –≤–æ–¥—É –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∫—É—Å–∞ –∑–∞–ª–µ–π—Ç–µ –∫–æ—Ñ–µ –≥–æ—Ä—è—á–µ–π –≤–æ–¥–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π 92-96 –≥—Ä–∞–¥—É—Å–æ–≤ –¥–∞–π—Ç–µ –Ω–∞—Å—Ç–æ—è—Ç—å—Å—è 4 –º–∏–Ω—É—Ç—ã –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–µ—Ä–µ–º–µ—à–∞–π—Ç–µ –∏ —É–¥–∞–ª–∏—Ç–µ –ø–µ–Ω–∫—É –ø–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â–µ –º–∏–Ω—É—Ç—É –Ω–∞–ª–∏–≤–∞–π—Ç–µ –∫–æ—Ñ–µ –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–≤–ª—è—è –≥—É—â—É –≤ —á–∞—à–∫–µ –¥–æ–±–∞–≤—å—Ç–µ —Å–∞—Ö–∞—Ä –∏–ª–∏ –º–æ–ª–æ–∫–æ –ø–æ –≤–∫—É—Å—É –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å"""
    },
    {
        "name": "–ö–æ—Ä–æ—Ç–∫–∞—è –∑–∞–º–µ—Ç–∫–∞",
        "text": """–≤—Å—Ç—Ä–µ—á–∞ –∑–∞–≤—Ç—Ä–∞ –≤ 10 —É—Ç—Ä–∞   –æ–±—Å—É–¥–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç   –ø—Ä–∏–Ω–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã    –Ω–µ –∑–∞–±—ã—Ç—å –ø—Ä–æ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é"""
    }
]


def print_comparison(original, formatted):
    """–í–∏–∑—É–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–æ/–ø–æ—Å–ª–µ"""
    print("\n" + "=" * 80)
    print("üìÑ –ò–°–•–û–î–ù–´–ô –¢–ï–ö–°–¢")
    print("=" * 80)
    print(original)
    print("\n" + "=" * 80)
    print("‚ú® –û–¢–§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ù–´–ô –¢–ï–ö–°–¢")
    print("=" * 80)
    print(formatted)
    print("=" * 80)


def main():
    """
    –î–µ–º–æ-—Ç–µ—Å—Ç –º–æ–¥—É–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    """
    print("üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LLM...")
    configure_module_llm()
    
    print("\n" + "üéØ " * 20)
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ú–û–î–£–õ–Ø –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø –¢–ï–ö–°–¢–ê")
    print("üéØ " * 20)
    
    # –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –º–æ–¥—É–ª—è
    formatter = TextFormatter()
    
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º –ø—Ä–∏–º–µ—Ä–µ
    for i, example in enumerate(TEST_EXAMPLES, 1):
        print(f"\n\n{'#' * 80}")
        print(f"# –ü–†–ò–ú–ï–† {i}: {example['name']}")
        print(f"{'#' * 80}")
        
        test_text = example['text']
        
        try:
            # –í—ã–∑–æ–≤ –º–æ–¥—É–ª—è
            print("\n‚è≥ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...")
            result = formatter(text=test_text)
            
            # –í—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            print_comparison(test_text, result.formatted_text)
            
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            original_len = len(test_text)
            formatted_len = len(result.formatted_text)
            print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
            print(f"   –ò—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç: {original_len} —Å–∏–º–≤–æ–ª–æ–≤")
            print(f"   –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π: {formatted_len} —Å–∏–º–≤–æ–ª–æ–≤")
            print(f"   –ò–∑–º–µ–Ω–µ–Ω–∏–µ: {formatted_len - original_len:+d} —Å–∏–º–≤–æ–ª–æ–≤")
            
        except Exception as e:
            print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–º–µ—Ä–∞ '{example['name']}': {e}")
            import traceback
            traceback.print_exc()
    
    print("\n\n" + "=" * 80)
    print("‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")
    print("=" * 80)
    print("\nüí° –°–æ–≤–µ—Ç: –û—Ü–µ–Ω–∏—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:")
    print("   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–∏ –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ?")
    print("   - –£–ª—É—á—à–∏–ª–∞—Å—å –ª–∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å?")
    print("   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω markdown?")


if __name__ == "__main__":
    main()
